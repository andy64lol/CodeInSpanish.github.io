<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitón IDE</title>
    <script src="brython.js"></script>
    <script src="brython_stdlib.js"></script>
    <script src="convertidor_python.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 60px;
            background: #252526;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 0;
            border-right: 1px solid #333;
        }

        .sidebar-icon {
            color: #858585;
            font-size: 24px;
            margin: 15px 0;
            cursor: pointer;
            transition: 0.3s;
        }

        .sidebar-icon:hover {
            color: #fff;
        }

        .main-container {
            flex: 1;
            display: flex;
        }

        .editor-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #333;
        }

        .editor-tabs {
            background: #2d2d2d;
            padding: 8px 15px;
            font-size: 0.9em;
            border-bottom: 1px solid #333;
        }

        .editor-content {
            flex: 1;
            position: relative;
        }

        .line-numbers {
            position: absolute;
            left: 0;
            top: 0;
            width: 40px;
            height: 100%;
            background: #1e1e1e;
            color: #858585;
            text-align: right;
            padding: 10px;
            font-family: 'Consolas', monospace;
            user-select: none;
        }

        #editor {
            width: 100%;
            height: 100%;
            padding: 10px 10px 10px 50px;
            background: #1e1e1e;
            border: none;
            color: #d4d4d4;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            white-space: pre;
            tab-size: 4;
        }

        .preview-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            background: #2d2d2d;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }

        #preview {
            flex: 1;
            background: #1e1e1e;
            border: none;
        }

        .divider {
            width: 5px;
            background: #333;
            cursor: col-resize;
        }

        .file-tree {
            width: 250px;
            background: #252526;
            padding: 15px;
            overflow-y: auto;
        }

        .tree-item {
            padding: 5px 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            border-radius: 3px;
        }

        .tree-item:hover {
            background: #2a2d2e;
        }

        .tree-item i {
            margin-right: 8px;
            color: #858585;
        }

        .run-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
    </style>
</head>
<body onload="brython()">
    <div class="sidebar">
        <i class="fa-regular fa-file-code sidebar-icon"></i>
        <i class="fa-solid fa-play sidebar-icon" onclick="convertAndRun()"></i>
        <i class="fa-solid fa-folder-open sidebar-icon"></i>
        <i class="fa-solid fa-gear sidebar-icon"></i>
    </div>

    <div class="file-tree">
        <div class="tree-item">
            <i class="fa-solid fa-folder"></i>
            Proyecto
        </div>
        <div class="tree-item" style="padding-left: 20px;">
            <i class="fa-regular fa-file"></i>
            main.ptn
        </div>
    </div>

    <div class="main-container">
        <div class="editor-pane">
            <div class="editor-tabs">
                <i class="fa-regular fa-file-code"></i> main.ptn
            </div>
            <div class="editor-content">
                <div class="line-numbers" id="lineNumbers"></div>
                <textarea id="editor" spellcheck="false">funcion factorial(n):
    si n == 0 entonces:
        retornar 1
    sino:
        retornar n * factorial(n - 1)
    fin si
fin funcion

imprimir("Factorial de 5:", factorial(5))</textarea>
            </div>
        </div>

        <div class="divider" id="divider"></div>

        <div class="preview-pane">
            <div class="preview-header">
                <span>Resultado</span>
                <button class="run-button" onclick="convertAndRun()">
                    <i class="fa-solid fa-play"></i> Ejecutar
                </button>
            </div>
            <iframe id="preview"></iframe>
        </div>
    </div>

    <script>
        // Manejo del divisor
        const divider = document.getElementById('divider');
        let isDragging = false;

        divider.addEventListener('mousedown', () => {
            isDragging = true;
            document.body.style.cursor = 'col-resize';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            const container = document.querySelector('.main-container');
            const editorPane = document.querySelector('.editor-pane');
            const previewPane = document.querySelector('.preview-pane');
            
            const containerRect = container.getBoundingClientRect();
            const newWidth = e.clientX - containerRect.left;
            
            editorPane.style.flex = `0 0 ${newWidth}px`;
            previewPane.style.flex = `1 1 ${containerRect.width - newWidth - 5}px`;
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            document.body.style.cursor = 'default';
        });

        // Numeración de líneas
        const editor = document.getElementById('editor');
        const lineNumbers = document.getElementById('lineNumbers');

        function updateLineNumbers() {
            const lines = editor.value.split('\n').length;
            lineNumbers.innerHTML = Array(lines).fill().map((_, i) => i + 1).join('<br>');
        }

        editor.addEventListener('input', updateLineNumbers);
        updateLineNumbers();
    </script>

    <script type="text/python">
        from browser import document, window

        def convertAndRun():
            try:
                editor_content = document["editor"].value
                python_code = window.convertirPitonAPython(editor_content)
                
                iframe = document["preview"]
                iframe_doc = iframe.contentDocument or iframe.contentWindow.document
                iframe_doc.open()
                iframe_doc.write(f"""
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <script src="brython.js"></script>
                        <script src="brython_stdlib.js"></script>
                        <style>
                            body {{ 
                                padding: 20px;
                                background: #1e1e1e;
                                color: #d4d4d4;
                                font-family: Consolas;
                            }}
                            .error {{ color: #f48771; }}
                        </style>
                    </head>
                    <body onload="brython()">
                        <script type="text/python">
                            try:
                                {python_code}
                            except Exception as e:
                                document <= html.DIV('Error: ' + str(e), Class='error')
                        </script>
                    </body>
                    </html>
                """)
                iframe_doc.close()
            except Exception as e:
                console.error(f"Error: {e}")
    </script>
</body>
</html>
